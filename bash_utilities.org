#+TITLE: Bash utilities
#+PROPERTY: header-args:shell :mkdirp yes :tangle-mode (identity #o755) :shebang "#!/bin/bash\n#AUTHOR: Jb Doyon<jb@jiby.tech>\nset -euo pipefail\n"

* Emacs aliases in bash
See more bash aliases and utilities in file:bash_utilities.org.
I sometimes want to open emacs (server-mode) from the command line,
and typing "emacsclient" is annoying.

#+BEGIN_SRC shell :tangle ~/.jb_profile.sh
export EDITOR="emacsclient -a '' -nw"
alias e="emacsclient -nw"
#+END_SRC
** Calculator
#+BEGIN_SRC shell :tangle ~/.jb_profile.sh
alias calc="emacsclient -nw -e '(calc)'"
#+END_SRC

** Magit
:PROPERTIES:
:SOURCE:   https://www.reddit.com/r/emacs/comments/9b1bhs/emacsshell_protip_alias_magit/
:END:
Type =magit= to get a terminal showing the repo.
See the [[file:config.org::*Magit][magit]] entry for what the hell =magit= is.

#+BEGIN_SRC shell :tangle ~/.jb_profile.sh
alias magit='emacsclient -nw -a emacs -e "(progn (magit-status) (delete-other-windows))"'
#+END_SRC



* De-google repo
I have an aversion to google repo tool, which breaks all my stuff.

#+BEGIN_SRC shell :tangle ~/bin/degooglerepo
function usage() {
    cat  <<EOF
Usage: $0 manifest

Converts a Google repo manifest.xml to a list of git clone commands printed to stdout
EOF
    exit 1

}

if [[ $# -lt 1 ]];
then
    usage
fi

# Assumptions:
# - manifest uses regex project on each of the repo xml lines
# - manifest xml entries are each on their own lines
# - xml tags for entries are doublequote-separated string fields
# - xml tag fields are ordered REPO-PATH-TAG


awk -F'"' '/project/ {print $2 " " $6 " " $4}'  $1 | sed 's|refs/tags/||' \
	 | awk '{print "git clone ssh://git/" $1 " -b " $2 " " $3}'
#+END_SRC


* Tangle in bash
From Org manual [[info:org#Batch%20execution][info:org#Batch execution]].
#+BEGIN_SRC shell :tangle ~/bin/emacs-tangle
# tangle files with org-mode
#
emacs -Q --batch --eval "
    (progn
      (require 'ob-tangle)
      (dolist (file command-line-args-left)
        (with-current-buffer (find-file-noselect file)
          (org-babel-tangle))))" "$@"
#+END_SRC
